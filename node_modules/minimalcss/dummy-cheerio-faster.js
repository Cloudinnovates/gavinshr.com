const cheerio = require('cheerio');
const $ = cheerio.load(`
<html>
<body>
<h2 class="title">Hello world</h2>
<div>
  <p>Hello</p>
  <p>Hello</p>
  <p>Hello</p>
</div>
</body>

</html>`);
const $2 = cheerio.load(`
<html>
<body>
<h2 class="title">Hello world</h2>
<div>
  <ul><li>One</li></ul>
</div>
</body>

</html>`);

const doms = [$, $2];
const debug = true;
const isSelectorMatchToAnyElement = selectorString => {
  // Here's the crucial part. Decide whether to keep the selector
  // Find at least 1 DOM that contains an object that matches
  // this selector string.
  for (const dom of doms) {
    try {
      const element = dom(selectorString);
      if (element.length > 0) {
        return [element, true];
      }
    } catch (ex) {
      // Be conservative. If we can't understand the selector,
      // best to leave it in.
      if (debug) {
        console.warn(selectorString, ex.toString());
      }
      return [null, true];
    }
  }
  console.log('HERE');
  return [null, false];
  // return doms.some(dom => {
  //   try {
  //     const element = dom(selectorString);
  //     // return dom(selectorString).length > 0;
  //     return [element, element.length > 0];
  //   } catch (ex) {
  //     // Be conservative. If we can't understand the selector,
  //     // best to leave it in.
  //     if (debug) {
  //       console.warn(selectorString, ex.toString());
  //     }
  //     return [null, true];
  //   }
  // });
};

['p', 'li', 'ol', 'ul li', 'foo::before*'].forEach(selector => {
  const [element, exists] = isSelectorMatchToAnyElement(selector);
  if (exists) {
    console.log(`${selector} exists`);
  }
});

// for (const dom of [$, $]) {
//   console.log(dom('p').length);
// }
// console.log($('p').length);
// // const dom = $('body');
// const dom = null;
// console.log($('p', dom).length);
